# Отчет по работе Keyword spotter

## Постановка задачи
Задача keyword spotting (обнаружение ключевых слов) заключается в автоматическом распознавании заранее заданных ключевых слов или коротких фраз в непрерывном потоке речи. Цель состоит в том, чтобы определить моменты появления конкретных слов или выражений среди общего потока звуковой информации.

Для решения дается задача многоклассовой классификации коротких аудиоотрезков. В аудиозаписях необходимо детектировать
5 различных ключевых слов и отнести запись к тому или иному ключевому слову.

Теоретический подход к решению задачи: аудиозапись разбивается на чанки с перекрытием, после чего к каждому чанку
применяется преобразования Фурье. Преобразование Фурье превращает временное представление сигнала в частотное. Таким
образом, в результате мы получаем mel-спектрограмму -- частотное представление во времени. В таком представлении
mel-спектрограммы можно обрабатывать свертками, поэтому в качестве backbone модели используются сверточные 
архитектуры.

## Исследование данных

Было проведено короткое исследование распределения данных, а также исследования распределения длины аудиозаписей в 
датасетах. Большого акцента на этой части делать не стоит. Для решения задачи подобраны хорошие датасеты. 
Дисбаланса в данных нет, распределения в тренировочной и валидационной выборках одинаковые, разброса по длине аудио нет.

![Распределение данных в тренировочном датасете](/docs/images/train_data_distribution.png)

![Распределение данных в валидационном датасете](/docs/images/validation_data_distribution.png)

![Распределение по длительности аудиозаписи](/docs/images/audio_len_distrib.png)

## Цифровая обработка

## Пайплайн обучения модели

## Направления исследований/экспериментов

### Поиск лучшей backbone архитектуры

Основное направление исследований -- подбор наиболее удачной backbone архитектуры. В работе было исследовано несколько
архитектур сверточных нейронных сетей. При подборе слоев ориетировались на общие принципы составления сверточных 
сетей, best prsctises известных архитектур (resnet, mobilenet, etc) и ограничение на количество параметров.

Результаты по архитектурам представлены в таблице.

![Результаты работы моделей](/docs/images/model_accuracy.png)

### Тюнинг параметров цифровой обработки

Первый этап обработки данных -- цифровая обработка (формирования mel-спектрограммы). У данного этапа есть свои 
гиперпараметры (частота сэмплирования, количество mel-фильтров и т. д.). Исследование показало:

- Параметры цифровой обработки не независимы. Существуют ограничения на варьирование параметров, обусловленные физическим обоснованием обработки
- Одна и та же архитектура при разных параметрах цифровой обработки может давать разные результаты (см. график)

![Распределение по длительности аудиозаписи](/docs/images/mel_spec_parameters_tuning.png)

### Представление данных

Изначально один сэмпл данных (одна аудиозапись) представлялась трехмерным тензором (num_channels, n_mels, time_samples), 
и в случае батча данных -- четырехмерным тензором (batch_size, num_channels, n_mels, time_samples).
Однако, учитывая особенность конкретной задачи, а именно -- мы работаем исключительно с одноканальными записями,
Данные можно представить в виде двумерных тензоров -- (n_mels, time_samples), трехмерным тенхором в случае батча 
данных (batch_size, n_mels, time_samples). Исследование показало, что снижение размерности данных уменьшает количество
MAC операций.

![MAC-операции](/docs/images/MAC2_compare.png)

### Аугментация данных

Для увеличения обобщающей способности моделей была предложена идея с аугментацией данных.
К аудиозаписям возможно применить простые аугментации: шифт по времени (но это может изменить 
звучание ключевого слова) и наложение маски. Для аугментации использовались средства пакета
torchaudio.

### Дистиляция моделей

Исследовался подход с дистиляцией моделей. Поскольку в задаче существует ограничение на 
количество параметров и вычислительных операций модели, можно использовтаь только небольшие 
модели. В таком случае, можно натренировать большие модели (Mobilenet, Resnet18) и обучить маленькую модель на ответы модели-учителя.

## Результаты